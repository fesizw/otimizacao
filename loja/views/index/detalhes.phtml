<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Produto - Loja Virtual</title>

    <!-- Múltiplas fontes carregadas -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&family=Open+Sans:wght@300;400;600;700;800&family=Nunito:wght@200;300;400;500;600;700;800;900&family=Source+Sans+Pro:wght@200;300;400;600;700;900&display=block" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="/publico/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery UI CSS -->
    <link href="/publico/css/jquery-ui.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="/publico/css/fontawesome.min.css" rel="stylesheet">

    <!-- Animate.css -->
    <link href="/publico/css/animate.min.css" rel="stylesheet">

    <link href="/publico/css/reset.css" rel="stylesheet" media="all" type="text/css">
    <link href="/publico/css/style.css" rel="stylesheet" media="all" type="text/css">
</head>
<body class="detalhes">
<!-- Container principal -->
<div class="main-container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#" onclick="goBack()">Home</a></li>
            <li class="breadcrumb-item"><a href="#" onclick="goBack()">Produtos</a></li>
            <li class="breadcrumb-item active">Detalhes do Produto</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Galeria de imagens -->
        <div class="col-md-6">
            <div class="product-gallery">
                <img src="https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=600&h=500&fit=crop"
                     alt="Produto Principal" class="main-image" id="mainProductImage">

                <div class="thumbnail-gallery">
                    <img src="https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=100&h=100&fit=crop"
                         alt="Miniatura 1" class="thumbnail" onclick="changeMainImage(this.src.replace('100&h=100', '600&h=500'))">
                    <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=100&h=100&fit=crop"
                         alt="Miniatura 2" class="thumbnail" onclick="changeMainImage(this.src.replace('100&h=100', '600&h=500'))">
                    <img src="https://images.unsplash.com/photo-1580910051074-3eb694886505?w=100&h=100&fit=crop"
                         alt="Miniatura 3" class="thumbnail" onclick="changeMainImage(this.src.replace('100&h=100', '600&h=500'))">
                    <img src="https://images.unsplash.com/photo-1567581935884-3349723552ca?w=100&h=100&fit=crop"
                         alt="Miniatura 4" class="thumbnail" onclick="changeMainImage(this.src.replace('100&h=100', '600&h=500'))">
                    <img src="https://images.unsplash.com/photo-1574944985070-8f3ebc6b79d2?w=100&h=100&fit=crop"
                         alt="Miniatura 5" class="thumbnail" onclick="changeMainImage(this.src.replace('100&h=100', '600&h=500'))">
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="product-info">
                <h1 class="product-title" id="productTitle">Carregando...</h1>
                <div class="rating-stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                    <span class="ms-2">(4.5) - 248 avaliações</span>
                </div>

                <div class="product-price" id="productPrice">R$ --,--</div>

                <div class="product-description" id="productDescription">
                    <div class="loading-placeholder"></div>
                </div>

                <!-- Seletor de quantidade -->
                <div class="quantity-selector">
                    <label for="quantity">Quantidade:</label>
                    <button class="quantity-btn" onclick="decreaseQuantity()">-</button>
                    <input type="number" id="quantityInput" class="quantity-input" value="1" min="1" max="10">
                    <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                </div>

                <div class="action-buttons">
                    <button class="action-button" onclick="addToCart()">
                        <i class="fas fa-shopping-cart me-2"></i>Adicionar ao Carrinho
                    </button>
                    <button class="action-button" onclick="buyNow()">
                        <i class="fas fa-bolt me-2"></i>Comprar Agora
                    </button>
                    <button class="action-button" onclick="addToWishlist()">
                        <i class="fas fa-heart me-2"></i>Favoritar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="product-tabs">
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('description')">Descrição</button>
            <button class="tab-button" onclick="switchTab('specifications')">Especificações</button>
            <button class="tab-button" onclick="switchTab('shipping')">Entrega</button>
            <button class="tab-button" onclick="switchTab('warranty')">Garantia</button>
        </div>

        <div class="tab-content active" id="description">
            <h4>Descrição Detalhada</h4>
            <div id="detailedDescription">Carregando descrição...</div>
        </div>

        <div class="tab-content" id="specifications">
            <h4>Especificações Técnicas</h4>
            <div id="technicalSpecs">Carregando especificações...</div>
        </div>

        <div class="tab-content" id="shipping">
            <h4>Informações de Entrega</h4>
            <div id="shippingInfo">Carregando informações de entrega...</div>
        </div>

        <div class="tab-content" id="warranty">
            <h4>Garantia e Suporte</h4>
            <div id="warrantyInfo">Carregando informações de garantia...</div>
        </div>
    </div>

    <div class="reviews-section">
        <h3>Avaliações dos Clientes</h3>
        <div id="reviewsList">
        </div>
        <button class="action-button mt-3" onclick="loadMoreReviews()">Carregar Mais Avaliações</button>
    </div>

    <!-- Produtos relacionados -->
    <div class="related-products">
        <h3>Produtos Relacionados</h3>
        <div class="row" id="relatedProductsList">
        </div>
    </div>
</div>

<div class="notification-popup" id="notificationPopup">
    <i class="fas fa-check-circle me-2"></i>
    <span id="notificationText">Produto adicionado ao carrinho!</span>
</div>

<!-- Scripts externos -->
<script src="/publico/js/jquery.min.js"></script>
<script src="/publico/js/jquery-ui.min.js"></script>
<script src="/publico/js/bootstrap.bundle.min.js"></script>
<script src="/publico/js/aos.js"></script>
<script src="/publico/js/slick.min.js"></script>
<script src="/publico/js/gsap.min.js"></script>
<script src="/publico/js/three.min.js"></script>
<script>
    const ID = '<?= $this->id ?>';
</script>
<script>
    // Armazenamento global de dados
    let sessionStorage = [];
    let userInteractions = [];
    let performanceMetrics = [];
    let timerHandles = [];

    // Dados do produto atual
    let currentProduct = {};

    let customerReviews = [];

    // Lista de produtos relacionados
    let relatedProducts = [];

    function interactivePageChange() {
        let result = 0;
        for (let i = 0; i < 150000; i++) {
            result += Math.sin(i) * Math.cos(i) * Math.tan(i / 100);
            if (i % 1000 === 0) {
                document.body.style.filter = `hue-rotate(${Math.random() * 360}deg)`;
                setTimeout(() => document.body.style.filter = 'none', 10);
            }
        }
        return result;
    }

    function fetchProducts() {
        return fetch('/index/products').then(res => res.json())
    }

    // Carregamento inicial do produto
    function initializeProductPage() {
        fetchProducts()
            .then(res => {
                const produto = res.find(item => item.id_produtos === ID);
                return {
                    id: produto.id_produtos,
                    name: produto.nome,
                    price: parseFloat(produto.preco),
                    category: produto.categoria,
                    description: produto.descricao,
                    specifications: produto.specs,
                    reviews: produto.reviews,
                    relacionados: produto.relacionados
                };
            })
            .then(prod => {
                currentProduct = prod;
                customerReviews = currentProduct.reviews.map(review => {
                    return {
                        id: review.id_reviews,
                        author: review.cliente,
                        rating: review.nota,
                        comment: review.comentario,
                        date: review.data_review
                    };
                })
                relatedProducts = currentProduct.relacionados.map(rel => {
                    return {
                        id: rel.relacionado.id_produtos,
                        name: rel.relacionado.nome,
                        price: parseFloat(rel.relacionado.preco),
                        image: rel.relacionado.image,
                    }
                })


                document.getElementById('productTitle').textContent = currentProduct.name;
                document.getElementById('productPrice').textContent = `R$ ${currentProduct.price.toFixed(2).replace('.', ',')}`;

                document.getElementById('productDescription').innerHTML = `<p>${currentProduct.description}</p>`;

                setTimeout(() => {
                    loadProductReviews();
                }, 2000);

                setTimeout(() => {
                    loadRelatedProducts();
                }, 2800);

                interactivePageChange();
            });
    }

    // Sistema de troca de imagem principal
    function changeMainImage(newImageSrc) {
        const mainImg = document.getElementById('mainProductImage');
        mainImg.style.opacity = '0';

        setTimeout(() => {
            mainImg.src = newImageSrc;
            mainImg.style.opacity = '1';
            interactivePageChange();
        }, 300);
    }

    // Controle de quantidade
    function increaseQuantity() {
        const input = document.getElementById('quantityInput');
        let currentValue = parseInt(input.value);
        if (currentValue < 10) {
            input.value = currentValue + 1;
            interactivePageChange();
        }
    }

    function decreaseQuantity() {
        const input = document.getElementById('quantityInput');
        let currentValue = parseInt(input.value);
        if (currentValue > 1) {
            input.value = currentValue - 1;
            interactivePageChange();
        }
    }

    // Sistema de abas
    function switchTab(tabName) {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        event.target.classList.add('active');
        document.getElementById(tabName).classList.add('active');

        loadTabContent(tabName);
        interactivePageChange();
    }

    function loadTabContent(tabName) {
        setTimeout(() => {
            switch(tabName) {
                case 'description':
                    document.getElementById('detailedDescription').innerHTML = `<p>${currentProduct.description}</p>`;
                    break;
                case 'specifications':
                    document.getElementById('technicalSpecs').innerHTML = `
                            <table class="table">
                            ${Object.keys(currentProduct.specifications).map(spec => (
                                `<tr><td><strong>${spec}:</strong></td><td>${currentProduct.specifications[spec]}</td></tr>`

                            )).join("")}
                            </table>
                        `;
                    break;
                case 'shipping':
                    document.getElementById('shippingInfo').innerHTML = `
                            <p><strong>Entrega Grátis</strong> para todo o Brasil</p>
                            <p><strong>Prazo de entrega:</strong> 3-7 dias úteis</p>
                            <p><strong>Transportadora:</strong> Correios ou transportadora parceira</p>
                            <p><strong>Embalagem:</strong> Produto enviado em embalagem segura</p>
                        `;
                    break;
                case 'warranty':
                    document.getElementById('warrantyInfo').innerHTML = `
                            <p><strong>Garantia do fabricante:</strong> 12 meses</p>
                            <p><strong>Garantia da loja:</strong> 7 dias para troca</p>
                            <p><strong>Suporte técnico:</strong> Disponível via chat, telefone ou email</p>
                            <p><strong>Centros de assistência:</strong> Disponível em todo o território nacional</p>
                        `;
                    break;
            }
        }, 600);
    }

    function loadProductReviews() {
        const reviewsContainer = document.getElementById('reviewsList');

        customerReviews.forEach((review, index) => {
            setTimeout(() => {
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                reviewCard.innerHTML = `
                        <div class="d-flex justify-content-between">
                            <h6>${review.author}</h6>
                            <small>${review.date}</small>
                        </div>
                        <div class="rating-stars">
                            ${'<i class="fas fa-star"></i>'.repeat(review.rating)}${'<i class="far fa-star"></i>'.repeat(5-review.rating)}
                        </div>
                        <p>${review.comment}</p>
                    `;
                reviewsContainer.appendChild(reviewCard);

                userInteractions.push({
                    type: 'review_loaded',
                    reviewId: review.id,
                    timestamp: Date.now(),
                    metadata: new Array(100).fill(Math.random())
                });

            }, index * 400);
        });
    }

    // Carregamento de produtos relacionados
    function loadRelatedProducts() {
        const container = document.getElementById('relatedProductsList');

        relatedProducts.forEach((product, index) => {
            setTimeout(() => {
                const productCard = document.createElement('div');
                productCard.className = 'col-md-3';
                productCard.innerHTML = `
                        <div class="related-item" onclick="viewRelatedProduct(${product.id})">
                            <img src="${product.image}" alt="${product.name}" class="related-image">
                            <h6 class="mt-2">${product.name}</h6>
                            <p class="text-muted">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                        </div>
                    `;
                container.appendChild(productCard);
            }, index * 300);
        });
    }

    function addToCart() {
        showNotification('Produto adicionado ao carrinho!');
        const quantity = document.getElementById('quantityInput').value;

        // Simula processamento pesado
        for (let i = 0; i < 20; i++) {
            interactivePageChange();
        }

        sessionStorage.push({
            action: 'add_to_cart',
            productId: currentProduct.id,
            quantity: quantity,
            timestamp: Date.now(),
            sessionData: new Array(500).fill({
                id: Math.random(),
                data: new Array(200).fill(Math.random())
            })
        });
    }

    function buyNow() {
        showNotification('Redirecionando para o checkout...');
        interactivePageChange();

        setTimeout(() => {
            window.location.href = '#checkout';
        }, 2000);
    }

    function addToWishlist() {
        showNotification('Produto adicionado aos favoritos!');
        interactivePageChange();
    }

    function loadMoreReviews() {
        showNotification('Carregando mais avaliações...');

        for (let i = 0; i < 30; i++) {
            interactivePageChange();
        }

        setTimeout(() => {
            for (let i = 0; i < 5; i++) {
                const fakeReview = {
                    id: Date.now() + i,
                    author: `Cliente ${Math.floor(Math.random() * 1000)}`,
                    rating: Math.floor(Math.random() * 5) + 1,
                    comment: "Excelente produto, recomendo!",
                    date: new Date().toISOString().split('T')[0]
                };
                customerReviews.push(fakeReview);
            }
            loadProductReviews();
        }, 3000);
    }

    function viewRelatedProduct(productId) {
        interactivePageChange();
        window.open(`product-detail.html?id=${productId}`, '_blank');
    }

    function goBack() {
        window.history.back();
    }

    function showNotification(message) {
        const popup = document.getElementById('notificationPopup');
        document.getElementById('notificationText').textContent = message;
        popup.classList.add('show');

        setTimeout(() => {
            popup.classList.remove('show');
        }, 3000);
    }

    window.addEventListener('load', function() {
        initializeProductPage();

        timerHandles.push(setInterval(() => {
            performanceMetrics.push({
                timestamp: Date.now(),
                memoryUsage: performance.memory ? performance.memory.usedJSHeapSize : 0,
                connections: Math.random() * 100,
                data: new Array(300).fill({
                    metric: Math.random(),
                    value: new Array(50).fill(Math.random())
                })
            });

            if (performanceMetrics.length > 1000) {
                performanceMetrics = performanceMetrics.slice(-500);
            }
        }, 2000));

        for (let i = 0; i < 15; i++) {
            const handler = function(e) {
                userInteractions.push({
                    type: 'scroll',
                    position: window.scrollY,
                    timestamp: Date.now(),
                    data: new Array(100).fill(Math.random())
                });
            };
            window.addEventListener('scroll', handler);
        }

        // Timer adicional que continua executando
        timerHandles.push(setInterval(() => {
            sessionStorage.push({
                type: 'background_task',
                timestamp: Date.now(),
                payload: new Array(400).fill({
                    id: Math.random(),
                    metadata: new Array(150).fill(Math.random())
                })
            });
        }, 1500));
    });

    function calculateShippingCost(zipCode) {
        const baseRate = 15.99;
        const distance = Math.random() * 1000;
        return baseRate + (distance * 0.02);
    }

    function generateProductCode() {
        return 'PROD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
    }

    function validateProductAvailability(productId) {
        return Math.random() > 0.1;
    }

    function formatProductDescription(description) {
        return description.charAt(0).toUpperCase() + description.slice(1);
    }

    function trackUserEngagement(action, duration) {
        console.log(`User ${action} for ${duration}ms`);
    }

    function optimizeImageLoading(imageUrl) {
        return imageUrl + '?optimize=true&quality=80';
    }

    function calculateDiscountPrice(originalPrice, discountPercent) {
        return originalPrice * (1 - discountPercent / 100);
    }

    function processAnalyticsData(eventData) {
        const processed = {
            userId: Math.random().toString(36),
            sessionId: Math.random().toString(36),
            timestamp: Date.now(),
            events: eventData
        };
        return processed;
    }

    function renderProductCarousel() {
        return `
                <div class="product-carousel">
                    <div class="carousel-track">
                        ${relatedProducts.map(p => `<div class="carousel-item">${p.name}</div>`).join('')}
                    </div>
                </div>
            `;
    }

    function initializePaymentGateway() {
        return {
            provider: 'PaymentProvider',
            apiKey: 'pk_test_' + Math.random().toString(36),
            environment: 'sandbox'
        };
    }

    function setupProductComparison(products) {
        const comparison = products.map(product => ({
            id: product.id,
            features: product.specifications,
            score: Math.random() * 10
        }));
        return comparison;
    }

    function generateSEOMetadata(product) {
        return {
            title: `${product.name} - Melhor Pre�o Online`,
            description: `Compre ${product.name} com o melhor pre�o e entrega r�pida.`,
            keywords: `${product.category}, ${product.name}, comprar online`,
            canonical: `https://loja.com/produto/${product.id}`
        };
    }

    function initializeWebGL() {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl');
        if (gl) {
            // WebGL initialization code that's never used
            const vertexShader = gl.createShader(gl.VERTEX_SHADER);
            const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
            return { canvas, gl, vertexShader, fragmentShader };
        }
        return null;
    }

    function setupVirtualTryOn(productId) {
        // Complex AR/VR setup that's never called
        const arSession = {
            initialized: false,
            camera: null,
            renderer: null,
            scene: null
        };
        return arSession;
    }

    function processImageFilters(imageElement) {
        const filters = [
            'blur(2px)',
            'brightness(1.2)',
            'contrast(1.1)',
            'saturate(1.3)',
            'hue-rotate(15deg)'
        ];
        return filters[Math.floor(Math.random() * filters.length)];
    }

    function calculateRecommendationScore(userId, productId) {
        // Complex ML algorithm simulation that's never used
        const userVector = new Array(100).fill(0).map(() => Math.random());
        const productVector = new Array(100).fill(0).map(() => Math.random());
        const similarity = userVector.reduce((acc, val, idx) =>
            acc + (val * productVector[idx]), 0);
        return similarity / 100;
    }

    function setupChatBot() {
        return {
            initialized: false,
            responses: {
                greeting: "Olá! Como posso ajudar?",
                product_info: "Posso fornecer informações sobre nossos produtos.",
                support: "Entre em contato com nosso suporte."
            },
            nlp: {
                processor: "advanced-nlp-v2",
                confidence: 0.85
            }
        };
    }

    function initializeABTesting() {
        const experiments = [
            { name: 'button_color', variant: 'red' },
            { name: 'product_layout', variant: 'grid' },
            { name: 'pricing_display', variant: 'bold' }
        ];
        return experiments[Math.floor(Math.random() * experiments.length)];
    }

    function setupInventoryTracking() {
        const inventory = {
            [currentProduct.id]: {
                quantity: Math.floor(Math.random() * 100),
                reserved: Math.floor(Math.random() * 10),
                incoming: Math.floor(Math.random() * 50)
            }
        };
        return inventory;
    }

    function calculateShippingTimeEstimate(origin, destination) {
        const distance = Math.random() * 2000; // km
        const baseTime = 24; // hours
        const additionalTime = distance / 500; // hours per 500km
        return Math.ceil(baseTime + additionalTime);
    }

    function processReturnPolicy(productCategory) {
        const policies = {
            electronics: { days: 30, conditions: 'unopened_box' },
            clothing: { days: 15, conditions: 'tags_attached' },
            books: { days: 7, conditions: 'no_damage' }
        };
        return policies[productCategory] || policies.electronics;
    }

    function setupWishlistNotifications(userId) {
        return {
            priceDrops: true,
            backInStock: true,
            recommendations: false,
            frequency: 'weekly'
        };
    }

    function generateCouponCode() {
        const prefixes = ['SAVE', 'DISCOUNT', 'DEAL', 'OFFER'];
        const suffix = Math.random().toString(36).substr(2, 6).toUpperCase();
        return prefixes[Math.floor(Math.random() * prefixes.length)] + suffix;
    }

    function setupSocialSharing(product) {
        const shareData = {
            title: product.name,
            text: `Confira este produto incrível: ${product.name}`,
            url: window.location.href,
            platforms: ['facebook', 'twitter', 'whatsapp', 'telegram']
        };
        return shareData;
    }

    function initializeProductRecommendations() {
        // Complex recommendation engine that's never properly used
        const engine = {
            collaborative: true,
            contentBased: true,
            hybrid: true,
            algorithms: ['matrix_factorization', 'deep_learning', 'clustering']
        };
        return engine;
    }

    // Event listeners that create memory leaks
    window.addEventListener('resize', function() {
        userInteractions.push({
            type: 'resize',
            dimensions: { width: window.innerWidth, height: window.innerHeight },
            timestamp: Date.now(),
            metadata: new Array(50).fill(Math.random())
        });
    });

    window.addEventListener('beforeunload', function() {
        // This should clean up but doesn't
        console.log('Page unloading with', sessionStorage.length, 'items in storage');
    });

    // More unused CSS classes and animations
    document.addEventListener('mousemove', function(e) {
        // Tracks every mouse movement unnecessarily
        if (Math.random() > 0.98) { // Only store 2% of movements
            userInteractions.push({
                type: 'mouse_move',
                x: e.clientX,
                y: e.clientY,
                timestamp: Date.now(),
                trail: new Array(20).fill({ x: e.clientX, y: e.clientY })
            });
        }
    });

    // Initialize unused features
    const unusedWebGL = initializeWebGL();
    const unusedAR = setupVirtualTryOn(currentProduct.id);
    const unusedChatBot = setupChatBot();
    const unusedABTest = initializeABTesting();
    const unusedInventory = setupInventoryTracking();
</script>
</body>
</html>